{% extends "main.html" %} {% load static %} {% block content %}
<br />
<br />
<br />
<br />
<br />

<h1 style="margin-left: 300px">Dashboard Flota</h1>

<div class="container text-center" style="margin-left: 300px">
    <div style="display:flex; justify-content;flex-end; margin-top: 20px; margin-left:300px">
        <a href="{% url 'create_bus' %}">
            <i
                class="fa-solid fa-circle-plus fa-2xl"
                style="color: #77bb41; margin-bottom: 40px"
            ></i
        ></a>
    </div>
    <div>
        <div class="row">
            <div class="col-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Kilometraje Flota</h5>
                        <i class="fa-solid fa-road"></i>
                        <h6 class="card-subtitle mb-2 text-body-secondary">{{km_total}} kms</h6>
                    </div>
                </div>
            </div>
            <!--segunda tarjeta -->
            <div class="col-3">
                <div class="card">
                    <div class="card-body">
                        <a href="{% url 'bus_list' %}">
                            <h5 class="card-title">Total Flota</h5>
                            <i class="fa-solid fa-bus"></i>
                            <h6 class="card-subtitle mb-2 text-body-secondary">
                                {{total_flota}} buses
                            </h6>
                        </a>
                    </div>
                </div>
            </div>
            <!--tercera tarjeta -->
            <div class="col-3">
                <div class="card">
                    <div class="card-body">
                        <a href="{% url 'fusi_dashboard' %}">
                            <h5 class="card-title">Fusi activos</h5>
                            <i class="fa-solid fa-circle-exclamation"></i>
                            <h6 class="card-subtitle mb-2 text-body-secondary">
                                {{open_fusi}} Codigos
                            </h6>
                        </a>
                    </div>
                </div>
            </div>
            <!--cuarta tarjeta -->
            <div class="col-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Buses en Operacion</h5>
                        <i class="fa-solid fa-road-circle-check"></i>
                        <h6 class="card-subtitle mb-2 text-body-secondary">*En construccion</h6>
                    </div>
                </div>
            </div>
            <!--fin perimera linea tarjetas-->

            <div class="col-3" style="margin-top: 20px">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Fuera de servicio</h5>
                        <i class="fa-solid fa-road-circle-xmark"></i>
                        <h6 class="card-subtitle mb-2 text-body-secondary">*En construccion</h6>
                    </div>
                </div>
            </div>

            <div class="col-3" style="margin-top: 20px">
                <a href="{% url 'warnings' %}">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Buses sin conexion</h5>
                            <i class="fa-solid fa-link-slash"></i>
                            <h6 class="card-subtitle mb-2 text-body-secondary">{{no_update}}</h6>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-3" style="margin-top: 20px">
                <a href="{% url 'warnings' %}">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Buses Carga Baja</h5>
                            <i class="fa-solid fa-charging-station"></i>
                            <h6 class="card-subtitle mb-2 text-body-secondary">
                                {{cant_low_50_soc}}
                            </h6>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-3" style="margin-top: 20px">
                <a href="{% url 'warnings' %}">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Buses con cola de archivos</h5>
                            <i class="fa-regular fa-calendar-xmark"></i>
                            <h6 class="card-subtitle mb-2 text-body-secondary">{{delayed}}</h6>
                        </div>
                    </div>
                </a>
            </div>

            <div class="row">
                <div class="col-9" style="margin-top: 20px">
                    <h2>Actualizaciones Buses</h2>
                    <table class="table">
                        <tr>
                            <th>Bus</th>
                            <th>Carga</th>
                            <th>Serie</th>
                            <th>Odometro</th>
                            <th>voltaje</th>
                            <th>Fusi Activo *in progress</th>
                            <th>actualizacion</th>
                            <th>Perfil</th>
                        </tr>
                        {% for i in complete_table %}
                        <tr>
                            <td>{{i.bus_name}}</td>
                            <td>
                                {% if i.lts_soc > 60 %}
                                <span class="badge rounded-pill text-bg-success"
                                    >{{ i.lts_soc }} %</span
                                >
                                {% elif i.lts_soc <= 60 and i.lts_soc > 40 %}
                                <span class="badge rounded-pill text-bg-warning"
                                    >{{ i.lts_soc }} %</span
                                >
                                {% elif i.lts_soc <= 40 %}
                                <span class="badge rounded-pill text-bg-danger"
                                    >{{ i.lts_soc }} %</span
                                >
                                {% else %} {{ i.lts_soc }} {% endif %}
                            </td>
                            <td>
                                {% if i.bus_series == 'Queltehue' %}
                                <button type="button" class="btn btn-outline-warning btn-sm">
                                    {{i.bus_series}}
                                </button>
                                {% elif i.bus_series == 'Tricahue' %}
                                <button type="button" class="btn btn-outline-success btn-sm">
                                    {{i.bus_series}}
                                </button>
                                {% endif %}
                            </td>
                            <td>{{i.lts_odometer}}</td>
                            <td>{{i.lts_24_volt}}</td>
                            <td>
                                {% if i.lts_fusi == 0.0 %}<i
                                    class="fa-regular fa-circle-check fa-xl"
                                    style="color: #77bb41"
                                ></i
                                >{% else %}
                                <button type="button" class="btn btn-outline-danger">
                                    {{i.lts_fusi}}
                                </button>
                                {% endif %}
                            </td>
                            <td>{{i.lts_update}}</td>
                            <td>
                                <a href="{% url 'bus_detail' i.id %}"
                                    ><button type="button" class="btn btn-outline-info">
                                        <i class="fa-solid fa-arrow-right"></i> Perfil
                                    </button></a
                                >
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                    {% if complete_table.has_other_pages %}
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            {% if complete_table.has_previous %}
                            <li class="page-item">
                                <a
                                    class="page-link"
                                    href="?page={{complete_table.previous_page_number}}"
                                    >Anterior</a
                                >
                            </li>
                            {% endif %} {% for page in paginator.page_range %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page }}">{{ page }}</a>
                            </li>
                            {% endfor %} {% if complete_table.has_next %}

                            <li class="page-item">
                                <a
                                    class="page-link"
                                    href="?page={{ complete_table.next_page_number }}"
                                    >Siguiente</a
                                >
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
                <div class="col-3" style="margin-top: 20px">
                    <h2>Informe Fusi</h2>
                    <table class="table">
                        <tr>
                            <th>Codigo Fusi</th>
                            <th>Repeticiones</th>
                        </tr>
                        {% for fusi in distinct_fusi_code %}
                        <tr>
                            <td>{{fusi.fusi_code}}</td>
                            <td>{{fusi.total}}</td>
                        </tr>
                        {% endfor %}
                    </table>
                    {% if distinct_fusi_code.has_other_pages %}
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            {% if distinct_fusi_code.has_previous %}
                            <li class="page-item">
                                <a
                                    class="page-link"
                                    href="?page_fusi={{distinct_fusi_code.previous_page_number}}"
                                    >Anterior</a
                                >
                            </li>
                            {% endif %} {% for page in paginator_fusi.page_range %}
                            <li class="page-item">
                                <a class="page-link" href="?page_fusi={{ page }}">{{ page }}</a>
                            </li>
                            {% endfor %} {% if distinct_fusi_code.has_next %}

                            <li class="page-item">
                                <a
                                    class="page-link"
                                    href="?page_fusi={{ distinct_fusi_code.next_page_number }}"
                                    >Siguiente</a
                                >
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
            <div class="row">
                <div class="col-4" style="margin-top: 20px">
                    <h2>top 10 buses/codigo fusi</h2>
                    <table class="table">
                        <tr>
                            <th>Bus</th>
                            <th>Cantidad Codigo Fusi</th>
                        </tr>
                        {% for i in top_buses %}
                        <tr>
                            <td>{{i.bus__bus_name}}</td>
                            <td>{{i.num_registros}} codigos</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endblock content %}
</div>
