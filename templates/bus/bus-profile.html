{% extends "main.html" %} {% load static %}{% block header%}BUS {{ bus.bus_name}}{%endblock header%} {% block content %}
<link rel="stylesheet" href="{% static 'styles/bus-profile.css' %}" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/easy-pie-chart/2.1.6/jquery.easypiechart.min.js"></script>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="option-button">
                {% if user.username == 'hurbx' or user.username == 'jose-troncoso' or user.username == 'Luis-Perez' %}
                <a href="{% url 'update_bus' bus.id %}"
                    ><button type="button" class="btn btn-primary">Editar Bus</button></a
                >
                <a href="{% url 'work_order_form' %}">
                    <button type="button" class="btn btn-info">Crear Parte</button></a
                >

                <a href="{% url 'delete_bus' bus.id %}">
                    <button type="button" class="btn btn-danger">Eliminar Bus</button></a
                >

                {% else %}
                <a href="{% url 'no-access' %}"> <button type="button" class="btn btn-primary">Editar Bus</button></a>

                <a href="{% url 'work_order_form' %}">
                    <button type="button" class="btn btn-info">Crear Parte</button></a
                >
                <a href="{% url 'no-access' %}"><button type="button" class="btn btn-danger">Eliminar Bus</button></a>

                {% endif %}
            </div>
        </div>
        <!--inicio tarjeta bus principal-->
        <div class="col-5">
            <div class="card custom-card">
                <img src="{{bus.bus_img.url}}" class="card-img-top" alt="..." />
                <div class="card-body">
                    <div class="card-text">
                        <div class="col-12">
                            <div style="box-shadow: none" class="card custom-card">
                                <div class="card-body">
                                    <h5 class="card-title">Datos del Bus</h5>
                                    <h6 class="card-subtitle mb-2 text-body-secondary">
                                        <span style="color: #0f8bfd">Actualizacion : {{bus.lts_update}}</span>
                                    </h6>
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">ECU</h5>
                                                    <p class="card-text custom-text">{{bus.bus_ecu}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Sniffer</h5>
                                                    <p class="card-text custom-text">{{bus.sniffer}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Patente</h5>
                                                    <p class="card-text custom-text">{{bus.plate_number}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 20px">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Serie</h5>
                                                    <p class="card-text custom-text">{{bus.bus_series}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Cliente</h5>
                                                    <p class="card-text custom-text">{{bus.client}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">VIN</h5>
                                                    <p class="card-text custom-text">Buscando info</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--fin tarjeta bus principal-->
        <div class="col-4">
            <div class="card custom-card">
                <div class="row">
                    <div class="col-6">
                        <div style="box-shadow: none" class="card custom-card">
                            <div class="card-body">
                                <h5 class="card-title">Bateria Actual</h5>
                                <div class="card-text">
                                    <div class="box">
                                        <div class="chart" data-percent="{{ bus.lts_soc }}" data-scale-color="#ffb400">
                                            {{ bus.lts_soc }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div style="box-shadow: none" class="card custom-card">
                            <div class="card-body">
                                <h5 class="card-title">SOH</h5>

                                <div class="card-text">
                                    <div class="box">
                                        <div class="chart" data-percent="1" data-scale-color="#ffb400">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--taejeta 2-->
            <div class="card custom-card twin">
                <div class="card-body">
                    <h5 class="card-title">Versiones Software</h5>
                    <div class="card-text">
                        <div class="col-12">
                            <div style="box-shadow: none" class="card custom-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Mark</h5>
                                                    <p class="card-text custom-text">{{bus.mark}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Jarvis</h5>
                                                    <p class="card-text custom-text">{{bus.jarvis}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Vision</h5>
                                                    <p class="card-text custom-text">{{bus.vision}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="box-shadow: none" class="card custom-card">
                        <div class="card-body">
                            <h5 class="card-title">Mediciones</h5>
                            <div class="row">
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title custom-title">KM</h5>
                                            <p class="card-text custom-text">{{bus.lts_odometer}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title">24 Volts</h5>
                                            <p class="card-text custom-text">{{ bus.lts_24_volt }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title">Aislacion</h5>
                                            <p class="card-text custom-text">{{bus.lts_isolation}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="card mb-3 custom-card">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img
                            src="https://plus.unsplash.com/premium_photo-1681487077388-5a2c641a1e21?q=80&w=3684&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                            class="img-fluid rounded-start"
                            alt="..."
                        />
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">CO2 Evitado</h5>
                            <p class="card-text">{{co2}} toneladas CO2</p>
                        </div>
                    </div>
                </div>
            </div>
            <!--aqui tabla con recorridos-->
            <div class="card custom-card">
                <h5 class="card-header">Recorrido buses</h5>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th>Km Inicial</th>
                                <th>Km Final</th>
                                <th>Recorrido</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            {% for data in result_data %}
                            <tr>
                                <td>{{ data.month }}</td>
                                <td>{{ data.value1 }}</td>
                                <td>{{ data.value2 }}</td>
                                <td>{{ data.difference }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div style="margin-top: 20px" class="row">
        <div class="col-4">
            <div class="card mb-3 custom-card">
                <div class="row g-0">
                    <div class="col-md-4 image-icon">
                        <a href="{% url 'bus_dailykm_pdf_report' bus.id %}">
                            <i class="bx bxs-down-arrow-square"></i>
                        </a>
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Kilometraje Diario</h5>
                            <p class="card-text">descargar informe km diario</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!---->
        <div class="col-4">
            <div class="card mb-3 custom-card">
                <div class="row g-0">
                    <div class="col-md-4 image-icon">
                        <a href="{% url 'bus_historic_fusi_pdf_report' bus.id %}"
                            ><i class="bx bxs-down-arrow-square"></i
                        ></a>
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Fusi historico</h5>
                            <p class="card-text">descargar informe fusi hisotorico</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!---->
        <div class="col-4">
            <div class="card mb-3 custom-card">
                <div class="row g-0">
                    <div class="col-md-4 image-icon">
                        <a href="{% url 'recorrido_mensual_pdf' bus.id %}"> <i class="bx bxs-down-arrow-square"></i></a>
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Recorrido Mensual</h5>
                            <p class="card-text">descargar informe recorrido</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="col-12" style="margin-top: 50px">
        <div class="card custom-card">
            <h5 class="card-header custom-header">Kilometraje maximo diario</h5>
            <div class="card-body">
                <div class="col-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Dia</th>
                                <th>Enero</th>
                                <th>Febrero</th>
                                <th>Marzo</th>
                                <th>Abril</th>
                                <th>Mayo</th>
                                <th>Junio</th>
                                <th>Julio</th>
                                <th>Agosto</th>
                                <th>Septiembre</th>
                                <th>Octubre</th>
                                <th>Noviembre</th>
                                <th>Diciembre</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            {% for i in results %}
                            <tr>
                                <td>{% if i.0 is None %} 0 {% else %}{{i.0}}{% endif %}</td>
                                <td>{% if i.1 is None %} 0 {% else %}{{i.1}} {% endif %}</td>
                                <td>{% if i.2 is None %} 0 {% else %}{{i.2}} {% endif %}</td>
                                <td>{% if i.3 is None %} 0 {% else %}{{i.3}} {% endif %}</td>
                                <td>{% if i.4 is None %} 0 {% else %}{{i.4}} {% endif %}</td>
                                <td>{% if i.5 is None %} 0 {% else %}{{i.5}} {% endif %}</td>
                                <td>{% if i.6 is None %} 0 {% else %}{{i.6}} {% endif %}</td>
                                <td>{% if i.7 is None %} 0 {% else %}{{i.7}} {% endif %}</td>
                                <td>{% if i.8 is None %} 0 {% else %}{{i.8}} {% endif %}</td>
                                <td>{% if i.9 is None %} 0 {% else %}{{i.9}} {% endif %}</td>
                                <td>{% if i.10 is None %} 0 {% else %}{{i.10}} {% endif %}</td>
                                <td>{% if i.11 is None %} 0 {% else %}{{i.11}} {% endif %}</td>
                                <td>{% if i.12 is None %} 0 {% else %}{{i.12}} {% endif %}</td>
                            </tr>

                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12" style="margin-top: 50px">
        <div class="card custom-card">
            <h5 class="card-header custom-header">Bitacora Fusi Bus</h5>
            <div class="card-body">
                <div class="col-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Codigo Fusi</th>
                                <th>Descripcion</th>
                                <th>Kilometraje</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in fusi %}
                            <tr>
                                <td>{{i.fusi_code}}</td>
                                <td>
                                    {% for mesa in message %} {% if mesa.fusi_code == i.fusi_code %}
                                    {{mesa.fusi_description|truncatechars:40 }} {% endif %} {% endfor %}
                                </td>
                                <td>{{i.failure_odometer}}</td>
                                <td>{{i.TimeStamp}}</td>
                                <td>{{i.fusi_state}}</td>

                                <td>
                                    <a href="{% url 'update-fusi-code' i.id  %}">
                                        <button type="button" class="btn btn-info">Editar Fusi</button>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% if fusi.has_other_pages %}
                    <nav class="navpag" aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            {% if fusi.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{fusi.previous_page_number}}">Anterior</a>
                            </li>
                            {% endif %} {% for page in paginator.page_range %} {% if page == fusi.number %}
                            <li class="page-item active">
                                <a class="page-link" href="?page={{page}}">{{page}}</a>
                            </li>
                            {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{page}}">{{page}}</a>
                            </li>
                            {% endif %} {% endfor %} {% if fusi.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{fusi.next_page_number}}">Siguiente</a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!--divisor-->

    <script src="{% static 'js/bus-profile-js.js' %}"></script>
</div>

< {% endblock content %}
