{% extends "main.html" %} {% load static %}{% block header%}BUS {{ bus.bus_name}}{%endblock header%} {% block content %}
<link rel="stylesheet" href="{% static 'styles/bus-profile.css' %}" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/easy-pie-chart/2.1.6/jquery.easypiechart.min.js"></script>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="option-button">
                {% if user.username == 'hurbx' or user.username == 'jose-troncoso' or user.username == 'Luis-Perez' %}
                <a href="{% url 'update_bus' bus.id %}"
                    ><button type="button" class="btn btn-primary">Editar Bus</button></a
                >
                <a href="{% url 'work_order_form' %}">
                    <button type="button" class="btn btn-info">Crear Parte</button></a
                >

                <a href="{% url 'delete_bus' bus.id %}">
                    <button type="button" class="btn btn-danger">Eliminar Bus</button></a
                >

                {% else %}
                <a href="{% url 'no-access' %}"> <button type="button" class="btn btn-primary">Editar Bus</button></a>

                <a href="{% url 'work_order_form' %}">
                    <button type="button" class="btn btn-info">Crear Parte</button></a
                >
                <a href="{% url 'no-access' %}"><button type="button" class="btn btn-danger">Eliminar Bus</button></a>

                {% endif %}
            </div>
        </div>
        <!--inicio tarjeta bus principal-->
        <div class="col-5">
            <div class="card custom-card">
                <img src="{{bus.bus_img.url}}" class="card-img-top" alt="..." />
                <div class="card-body">
                    <div class="card-text">
                        <div class="col-12">
                            <div style="box-shadow: none" class="card custom-card">
                                <div class="card-body">
                                    <h5 class="card-title">Datos del Bus</h5>
                                    <h6 class="card-subtitle mb-2 text-body-secondary">
                                        <span style="color: #0f8bfd">Actualizacion : {{bus.lts_update}}</span>
                                    </h6>
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">ECU</h5>
                                                    <p class="card-text custom-text">{{bus.bus_ecu}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Sniffer</h5>
                                                    <p class="card-text custom-text">{{bus.sniffer}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Patente</h5>
                                                    <p class="card-text custom-text">{{bus.plate_number}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 20px">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Serie</h5>
                                                    <p class="card-text custom-text">{{bus.bus_series}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Cliente</h5>
                                                    <p class="card-text custom-text">{{bus.client}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">VIN</h5>
                                                    <p class="card-text custom-text">Buscando info</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--fin tarjeta bus principal-->
        <div class="col-4">
            <div class="card custom-card">
                <div class="row">
                    <div class="col-6">
                        <div style="box-shadow: none" class="card custom-card">
                            <div class="card-body">
                                <h5 class="card-title">Bateria Actual</h5>
                                <div class="card-text">
                                    <div class="box">
                                        <div class="chart" data-percent="{{ bus.lts_soc }}" data-scale-color="#ffb400">
                                            {{ bus.lts_soc }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div style="box-shadow: none" class="card custom-card">
                            <div class="card-body">
                                <h5 class="card-title">SOH</h5>

                                <div class="card-text">
                                    <div class="box">
                                        <div class="chart" data-percent="1" data-scale-color="#ffb400">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--taejeta 2-->
            <div class="card custom-card twin">
                <div class="card-body">
                    <h5 class="card-title">Versiones Software</h5>
                    <div class="card-text">
                        <div class="col-12">
                            <div style="box-shadow: none" class="card custom-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Mark</h5>
                                                    <p class="card-text custom-text">{{bus.mark}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Jarvis</h5>
                                                    <p class="card-text custom-text">{{bus.jarvis}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="card custom-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Vision</h5>
                                                    <p class="card-text custom-text">{{bus.vision}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="box-shadow: none" class="card custom-card">
                        <div class="card-body">
                            <h5 class="card-title">Mediciones</h5>
                            <div class="row">
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title custom-title">KM</h5>
                                            <p class="card-text custom-text">{{bus.lts_odometer}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title">24 Volts</h5>
                                            <p class="card-text custom-text">{{ bus.lts_24_volt }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <h5 class="card-title">Aislacion</h5>
                                            <p class="card-text custom-text">{{bus.lts_isolation}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="card mb-3 custom-card">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img
                            src="https://plus.unsplash.com/premium_photo-1681487077388-5a2c641a1e21?q=80&w=3684&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                            class="img-fluid rounded-start"
                            alt="..."
                        />
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">CO2 Evitado</h5>
                            <p class="card-text">calculando... tons</p>
                        </div>
                    </div>
                </div>
            </div>
            <!--aqui tabla con recorridos-->
            <div class="card custom-card">
                <h5 class="card-header">Recorrido buses</h5>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th>Km Inicial</th>
                                <th>Km Final</th>
                                <th>Recorrido</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            {% for i in monthly_result %}
                            <tr>
                                <td>Enero</td>
                                <td>{{ i.1 }}</td>
                                <td>{{i.2}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Febrero</td>
                                <td>{{ i.3 }}</td>
                                <td>{{i.4}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Marzo</td>
                                <td>{{ i.5 }}</td>
                                <td>{{i.6}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Abril</td>
                                <td>{{ i.7 }}</td>
                                <td>{{i.8}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Mayo</td>
                                <td>{{ i.9 }}</td>
                                <td>{{i.10}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Junio</td>
                                <td>{{ i.11 }}</td>
                                <td>{{i.12}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Julio</td>
                                <td>{{ i.13 }}</td>
                                <td>{{i.14}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Agosto</td>
                                <td>{{ i.15 }}</td>
                                <td>{{i.16}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Septiembre</td>
                                <td>{{ i.17 }}</td>
                                <td>{{i.18}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Octubre</td>
                                <td>{{ i.19 }}</td>
                                <td>{{i.20}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Noviembre</td>
                                <td>{{ i.21 }}</td>
                                <td>{{i.22}}</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Diciembre</td>
                                <td>{{ i.23 }}</td>
                                <td>{{i.24}}</td>
                                <td></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--divisor-->

<div class="container text-center">
    <h2>Kilometrajes Diarios</h2>

    <table class="table">
        <tr>
            <th>Dia</th>
            <th>Enero</th>
            <th>Febrero</th>
            <th>Marzo</th>
            <th>Abril</th>
            <th>Mayo</th>
            <th>Junio</th>
            <th>Julio</th>
            <th>Agosto</th>
            <th>Septiembre</th>
            <th>Octubre</th>
            <th>Noviembre</th>
            <th>Diciembre</th>
        </tr>
        {% for i in results %}
        <tr>
            <td>{% if i.0 is None %} 0 {% else %}{{i.0}}{% endif %}</td>
            <td>{% if i.1 is None %} 0 {% else %}{{i.1}} {% endif %}</td>
            <td>{% if i.2 is None %} 0 {% else %}{{i.2}} {% endif %}</td>
            <td>{% if i.3 is None %} 0 {% else %}{{i.3}} {% endif %}</td>
            <td>{% if i.4 is None %} 0 {% else %}{{i.4}} {% endif %}</td>
            <td>{% if i.5 is None %} 0 {% else %}{{i.5}} {% endif %}</td>
            <td>{% if i.6 is None %} 0 {% else %}{{i.6}} {% endif %}</td>
            <td>{% if i.7 is None %} 0 {% else %}{{i.7}} {% endif %}</td>
            <td>{% if i.8 is None %} 0 {% else %}{{i.8}} {% endif %}</td>
            <td>{% if i.9 is None %} 0 {% else %}{{i.9}} {% endif %}</td>
            <td>{% if i.10 is None %} 0 {% else %}{{i.10}} {% endif %}</td>
            <td>{% if i.11 is None %} 0 {% else %}{{i.11}} {% endif %}</td>
            <td>{% if i.12 is None %} 0 {% else %}{{i.12}} {% endif %}</td>
        </tr>

        {% endfor %}
    </table>

    <h2>Kilometrajes Diarios</h2>

    <table class="table">
        <tr>
            <th>Bus</th>
            <th>Ene Min</th>
            <th>Ene Max</th>
            <th>Feb Min</th>
            <th>Feb Max</th>
            <th>Mar Min</th>
            <th>Mar Max</th>
            <th>Abr Min</th>
            <th>Abr Max</th>
            <th>May Min</th>
            <th>May Max</th>
            <th>Jun Min</th>
            <th>Jun Max</th>
            <th>Jul Min</th>
            <th>Jul Max</th>
            <th>Ago Min</th>
            <th>Ago Max</th>
            <th>Sep Min</th>
            <th>Sep Max</th>
            <th>Oct Min</th>
            <th>Oct Max</th>
            <th>Nov Min</th>
            <th>Nov Max</th>
            <th>Dic Min</th>
            <th>Dic Max</th>
        </tr>
        {% for i in monthly_result %}
        <tr>
            <td>{{ i.0 }}</td>
            <td>{% if i.1 is None %} 0 {% else %}{{i.1}} Km{% endif %}</td>
            <td>{% if i.2 is None %} 0 {% else %}{{i.2}} Km{% endif %}</td>
            <td>{% if i.3 is None %} 0 {% else %}{{i.3}} Km{% endif %}</td>
            <td>{% if i.4 is None %} 0 {% else %}{{i.4}} Km{% endif %}</td>
            <td>{% if i.5 is None %} 0 {% else %}{{i.5}} Km{% endif %}</td>
            <td>{% if i.6 is None %} 0 {% else %}{{i.6}} Km{% endif %}</td>
            <td>{% if i.7 is None %} 0 {% else %}{{i.7}} Km{% endif %}</td>
            <td>{% if i.8 is None %} 0 {% else %}{{i.8}} Km{% endif %}</td>
            <td>{% if i.9 is None %} 0 {% else %}{{i.9}} Km{% endif %}</td>
            <td>{% if i.10 is None %} 0 {% else %}{{i.10}} Km{% endif %}</td>
            <td>{% if i.11 is None %} 0 {% else %}{{i.11}} Km{% endif %}</td>
            <td>{% if i.12 is None %} 0 {% else %}{{i.12}} Km{% endif %}</td>
            <td>{% if i.13 is None %} 0 {% else %}{{i.13}} Km{% endif %}</td>
            <td>{% if i.14 is None %} 0 {% else %}{{i.14}} Km{% endif %}</td>
            <td>{% if i.15 is None %} 0 {% else %}{{i.15}} Km{% endif %}</td>
            <td>{% if i.16 is None %} 0 {% else %}{{i.16}} Km{% endif %}</td>
            <td>{% if i.17 is None %} 0 {% else %}{{i.17}} Km{% endif %}</td>
            <td>{% if i.18 is None %} 0 {% else %}{{i.18}} Km{% endif %}</td>
            <td>{% if i.19 is None %} 0 {% else %}{{i.19}} Km{% endif %}</td>
            <td>{% if i.20 is None %} 0 {% else %}{{i.20}} Km{% endif %}</td>
            <td>{% if i.21 is None %} 0 {% else %}{{i.21}} Km{% endif %}</td>
            <td>{% if i.22 is None %} 0 {% else %}{{i.22}} Km{% endif %}</td>
            <td>{% if i.23 is None %} 0 {% else %}{{i.23}} Km{% endif %}</td>
            <td>{% if i.24 is None %} 0 {% else %}{{i.24}} Km{% endif %}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Bitacora Bus</h2>

    <h2>Bitacora Codigos Fusi</h2>
    <table class="table">
        <tr>
            <th>Codigo Fusi</th>
            <th>Km</th>
            <th>Comentario</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th></th>
        </tr>
        {% for i in fusi %}
        <tr>
            <td>{{i.fusi_code}}</td>
            <td>{{i.failure_odometer}}</td>
            <td>{{i.fusi_comment}}</td>
            <td>{{i.TimeStamp}}</td>
            <td>{{i.fusi_state}}</td>
            <td>
                <a href="{% url 'update-fusi-code' i.id  %}">
                    <button>Editar codigo fusi</button>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
<script src="{% static 'js/bus-profile-js.js' %}"></script>

{% endblock content %}
